Booting The System
==================

Concepts & Configuration Files
==============================
Boot Loader  is a program that loads the operating system when the box is powered on.
Boot loader process:
1. Box is powered on.
2. System will look for a bootable device eiter configure in EUFI or if it's a BIOS by searching for a Master Boot Record or GPT on attached devices.
3. Master Boot Record or GPT contains information about the boot loader. Once the boot loader is found the system passes control to the boot loader.
4. Once the boot loader is loaded it presents a menu of kernel options to boot to, if multiple kernels are found on the system.
5. The boot loader loads the kernel into memory or initramfs.
6. The boot loader then gives control to the kernel passing in any options specified in the config or at boot time.
7. Kernel starts all hadware modules and initializes all hardware it can find the runs init on the system still running from initramfs(again this is pid 1 from our system boot process).
8. Initramfs version of systemd will move the system into the initrd.target which will mount root file systems.
9. The kernel root file system is then swithed from initramfs to the root file system /.
10. Systemd takes over and the default target as specified is called.

Instaling GRUB2:
- Installed by default during installation.
- There are times that you can install GRUB2 yourself such as creating bootable USB or CDROMs.
- $grub-install [device]
    - This command will install the boot loader on the specified device.
    - Recues disk and live cd's will use this method to be created.

GRUB vs GRUB2:
- /boot/grub/menu.lst has been replaced with /boot/grub/grub.cfg in GRUB2
- Custom menu items can be created in /etc/grub.d/40_custom
- GRUB2 main configuration file is now located in /boot/grub/grub.cfg
    - This is not to be edited manually but is instead populated from a set of scripts and files.
    - /etc/grub.d location of custom scripts that create the grub.cfg
    - /etc/defaults/grub

System Recovery:
- Before the OS boots you can actually pass parameters to the boot loader before the boot loader begins. This enables the admin to be able to enter into recovery mode and restore an issue that is related to the boot loader.
- Generally the best method for restoring an issue is to re-generate the GRUB2 configuration file.
    $grub2-mkconfig > /boot/grub/grub.cfg
    $grub-mkconfig > /boot/grub/grub.cfg

Grub-install and Grub-mkconfig
==============================

/boot/grub/grub.cfg, DO NOT EDIT it's autogenerated from /etc/ files, this files says how to load a kernel.
    - /etc/default/grub, grub default parameters like default timeout for menu 
    - /etc/grub.d/, menu entries.
    - After changing or adding parameters, /boot/grub/grub.cfg needs to be regenerated or modification won't be applied.
        - $grub2-mkconfig > /boot/grub2/grub.cfg
        - $grub-mkconfig > /boot/grub2/grub.cfg

To install or reinstall the boot loader:
    - $grub2-install [device_with_MBR] 


GRUB2 and GRUB Legacy Configuration Files
=========================================

- /boot/grub/grub.cfg or /boot/grub2/grub.cfg is the name of the GRUB2 configuration file.
- /etc/grub.conf, GRUB legacy configuration file for Red Hat/CentOS and is only a symlink to grub.cfg location in /boot/grub/
- /etc/grub.cfg - GRUB2 configuration file and is only a symlink to grub.cfg in /boot/grub/
- /boot/grub/menu.lst - GRUB legay configuration file for Ubuntu/Debian


initramfs and /boot
===================

/boot, contains configuration files related to booting the system.
    - Grub configuration
    - Initramfs configuration
    - Kernel image configuration

initramfs, is a gzip'ed cpio archive that contains the kernel modules required for all hardware needed in order for the system boot. It will also load init scripts and additional functionality in order for the system to boot. On some systems like CentOS 7 initramfs contains an entire usable system within itself.

After the bot loader hands over the boot process to the kernel, the kernel will load and initialize the harware required for the system. The information/drivers for this hardware is found by the kernel in the initramfs. As soon as the hardware is initialized the init system is started as PID 1. As soon as the init system has completed boot up initramfs hands off the root file system from /sysroot to / and mounts it on your system as configured in the /etc/fstab directory.
